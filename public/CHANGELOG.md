# 版本更新日志

## [0.3.1] - 2025-12-29

### 🔧 性能优化
- **被动回血系统性能优化**: 大幅提升游戏运行性能
  - 优化 `usePassiveRegeneration` hook，使用 `useMemo` 缓存 `maxHp` 计算结果
  - 从每秒重复计算改为按需计算，只在相关属性变化时重新计算
  - 使用内容比较替代引用比较，避免对象/数组引用变化导致的不必要重新计算
  - 预计性能提升 90%+，显著减少 CPU 占用
  - 优化依赖项管理，使用字符串键（JSON.stringify 或内容摘要）比较对象/数组内容

### 🛡️ 类型安全改进
- **移除不安全的类型转换**: 提升代码类型安全性
  - 移除 `App.tsx` 中的 `as any` 类型转换
  - 创建类型守卫函数 `isValidDailyQuestType`，提供运行时类型验证
  - 提取类型守卫函数到 `utils/typeGuards.ts` 独立文件，便于复用和维护
  - 确保类型安全的同时保持代码的可读性和可维护性

### 🔄 React Hooks 优化
- **useEffect 依赖项完善**: 修复潜在的 bug 和性能问题
  - 修复等级提升检查 useEffect 的依赖项，添加所有使用的函数和状态
  - 修复突破成功监听 useEffect 的依赖项，确保正确响应状态变化
  - 移除不必要的 `eslint-disable` 注释，确保依赖项完整性
  - 提升代码的可靠性和可维护性

### 📚 代码质量提升
- **代码组织优化**: 改进代码结构和可维护性
  - 提取类型守卫函数到独立工具文件
  - 优化依赖项管理，使用更细粒度的比较策略
  - 改进代码注释，清晰说明优化策略和实现细节
  - 通过 lint 检查，确保代码质量

### 🎯 稳定性提升
- 修复潜在的依赖项缺失问题，确保 React hooks 正确工作
- 优化性能关键路径，减少不必要的计算和重新渲染
- 提升类型安全性，减少运行时错误的可能性
- 改进代码可维护性，便于后续开发和维护

---

## [0.3.0] - 2025-12-26

### 🎉 新增功能
- **事件模板库系统**: 完整的历练事件模板生成系统
  - 生成 3000 个事件模板，包含各种历练类型和丰富的事件内容
  - 普通历练事件：1500 个（60%），涵盖日常修炼、探索、战斗等场景
  - 大机缘事件：500 个（10%），提供特殊奖励和机遇
  - 秘境探索事件：700 个（25%），包含不同风险等级的秘境冒险
  - 宗门挑战事件：300 个（5%），涉及宗门任务和挑战
  - 使用确定性随机数生成器，确保相同种子生成相同结果，提升游戏体验的一致性
  - 支持多种事件类型：物品获得、宠物获得、属性变化、声望变化、传承等级变化等
  - 事件模板库在游戏启动时自动初始化，提供丰富的历练内容

### 🔧 优化改进
- **声望商店体验优化**: 改进声望商店的物品显示逻辑
  - 声望商店现在会显示所有物品，即使当前境界无法购买
  - 无法购买的物品会显示为灰色，并显示具体的禁用原因（声望不足/境界不足/灵石不足）
  - 购买按钮会显示详细的提示信息，鼠标悬停时显示完整原因
  - 优化物品类型筛选器，显示所有可用的物品类型
- **功法学习系统优化**: 增强功法学习的稳定性和可靠性
  - 优化状态更新逻辑，在 `setPlayer` 回调中再次验证所有条件，防止竞态条件
  - 增强防重复学习机制，确保不会因为快速点击导致学习失败
  - 延长防重复点击时间从 500ms 到 1000ms，给状态更新更充足的时间
  - 优化错误处理，避免重复警告提示
- **洞府种植系统优化**: 改进种子匹配逻辑
  - 支持多种匹配方式：精确名称匹配、ID 匹配、ID 格式提取名称匹配
  - 修复当传入 ID（如 `herb-雪莲花`）但背包中物品名称是 `雪莲花` 时无法匹配的问题
  - 支持未在 `PLANTABLE_HERBS` 中定义的草药也能正确匹配
  - 改进错误提示，显示正确的草药名称

### 🐛 Bug修复
- **声望商店**: 修复声望商店不显示物品的问题
  - 修复根据境界过滤导致物品不显示的问题
  - 现在即使无法购买，也会显示所有物品供玩家查看
- **功法学习**: 修复功法学习有概率失败的问题
  - 修复异步状态更新导致的竞态条件
  - 修复快速点击可能导致的学习失败
  - 确保所有检查条件在状态更新时再次验证
- **洞府种植**: 修复种子判断逻辑问题
  - 修复 `herb-雪莲花` 格式的 ID 无法匹配背包中 `雪莲花` 名称物品的问题
  - 修复未定义草药无法正确匹配的问题
  - 改进查找逻辑，支持多种匹配方式

### 🗑️ 系统清理
- **传承系统简化**: 清理传承系统，移除不必要的功能
  - 移除传承经验（`inheritanceExp`）系统，简化传承机制
  - 保留传承突破境界功能，移除等级和经验相关逻辑
  - 清理相关 UI 和状态管理代码
  - 优化事件模板，确保传承等级变化逻辑正确

### 📚 代码优化
- **类型安全**: 完善类型定义
  - 从 `PlayerStats` 接口中移除 `inheritanceExp` 字段
  - 清理相关类型定义，提升类型安全性
- **代码审查**: 全面审查和优化
  - 审查声望商店相关代码，修复显示问题
  - 审查功法学习逻辑，修复状态更新问题
  - 审查洞府种植逻辑，修复种子匹配问题
  - 优化代码结构，提升可维护性

### 🎯 稳定性提升
- 修复潜在的竞态条件问题
- 改进状态管理逻辑，确保数据一致性
- 优化异步操作处理，提升系统稳定性
- 改进错误处理机制，提供更友好的用户反馈

---

## [0.2.9] - 2025-12-22

### 🎉 新增功能
- **宗门宝库系统**: 完整的宗门宝库功能
  - 新增"宗门宝库钥匙"物品，作为宗主可重复使用，打开宗门宝库
  - 宝库物品根据玩家境界生成，境界越高获得高品质物品概率越大
  - 宝库物品拿一件少一件，已拿取的物品不会再次显示
  - 宝库状态会保存到存档中，支持跨会话使用
  - 显示宝库统计信息（剩余物品数量、已拿取数量）
  - 空宝库时显示友好提示
- **材料包系统**: 新增材料包物品
  - 新增四种稀有度的材料包：仙品、传说、稀有、普通
  - 使用材料包可获得3-6个对应品级的随机丹药
  - 材料包可在背包中正常使用，支持批量使用
  - 获得的丹药会自动叠加到背包中
- **洞府系统**: 完整的洞府管理功能
  - 支持购买和升级洞府（1-10级），不同等级提供不同的修炼速度加成和种植槽位
  - 种植系统：可在洞府中种植各种灵草，支持境界要求检查
  - 自动收获功能：4级及以上洞府支持自动收获，成熟的灵草每30秒自动收获到背包
  - 聚灵阵改造：可消耗灵石改造聚灵阵，进一步提升修炼速度加成
  - 灵草图鉴系统：收集不同灵草可解锁图鉴，完成图鉴可获得奖励
  - 加速功能：支持使用灵石加速灵草生长，每日有使用次数限制
  - 批量收获：支持一键收获所有成熟的灵草
  - 实时进度显示：显示灵草生长进度和剩余时间，每分钟自动更新

### 🔧 优化改进
- **性能优化**: 大幅提升游戏性能
  - 创建深度比较工具函数（`objectUtils.ts`），替代 `JSON.stringify` 进行对象比较
  - 优化物品效果比较逻辑，从 O(n) JSON 序列化改为 O(n) 深度比较（更快且无序列化开销）
  - 批量操作使用 `Set` 替代数组查找，从 O(n²) 优化为 O(n)
  - 优化宗门宝库物品生成逻辑，使用 `useCallback` 避免不必要的重新计算
  - 优化宝库状态管理，使用 `Set` 提高查找性能
- **代码质量**: 提升代码可维护性
  - 统一使用稀有度工具函数，减少重复代码
  - 优化 React Hooks 使用，避免副作用和性能问题
  - 改进组件结构，将初始化逻辑从 `useMemo` 移到 `useEffect`
  - 统一对象比较逻辑，便于维护和复用
- **用户体验**: 改进交互体验
  - 宗门宝库弹窗层级优化，确保在背包弹窗之上显示
  - 添加宝库统计信息显示，让玩家了解进度
  - 优化空宝库提示，提供清晰的反馈
  - 材料包和宝库钥匙在背包中正确显示为可使用状态

### 🐛 Bug修复
- **物品系统**: 修复材料包和宝库钥匙无法使用的问题
  - 修复材料包在背包中不显示"使用"按钮的问题
  - 修复宝库钥匙无法使用的问题
  - 修复批量使用功能中材料包和宝库钥匙无法识别的问题
  - 添加材料包和宝库钥匙的使用说明
- **宝库系统**: 修复宝库物品类型问题
  - 修复从草药池获取物品时类型错误的问题
  - 确保材料包生成的物品类型正确（强制为丹药类型）
  - 修复空数组边界情况，添加默认丹药作为后备
  - 修复装备类物品错误叠加的问题
- **兼容性**: 确保旧存档兼容
  - 添加宝库状态字段的兼容性处理
  - 确保旧存档加载时正确初始化宝库状态
  - 修复存档加载时的类型安全问题

### 📚 代码优化
- **工具函数**: 新增对象比较工具
  - 创建 `utils/objectUtils.ts`，提供 `deepEqual` 和 `compareItemEffects` 函数
  - 统一对象比较逻辑，提升代码复用性
  - 优化比较性能，减少内存占用
- **类型安全**: 完善类型定义
  - 在 `PlayerStats` 接口中添加 `sectTreasureVault` 字段
  - 完善宝库相关类型定义，提升类型安全性
  - 优化类型检查，减少运行时错误
- **代码审查**: 全面审查和优化
  - 审查宗门宝库相关代码，修复潜在问题
  - 优化性能瓶颈，提升整体性能
  - 改进代码结构，提升可维护性

### 🎯 稳定性提升
- 修复潜在的运行时错误
- 改进状态管理逻辑，确保数据一致性
- 优化内存使用，减少临时对象创建
- 提升批量操作的性能，特别是处理大量物品时
- 改进错误处理机制，提升系统稳定性

---

## [0.2.8] - 2025-12-22

### 🐛 Bug修复
- **问题修复**: 抽奖逻辑调整&声望时间自动历练可以正常触发还有一些小数值调整，顺便换了个免费模型
---

## [0.2.7] - 2025-12-21

### 🔧 游戏平衡调整
- **境界升级难度提升**: 提高所有境界的修为需求
  - 将所有境界的 `maxExpBase` 提升至原来的 2.5 倍，放慢游戏节奏
  - 炼气期：100 → 250
  - 筑基期：1,000 → 2,500
  - 金丹期：5,000 → 12,500
  - 元婴期：25,000 → 62,500
  - 化神期：100,000 → 250,000
  - 炼虚期：500,000 → 1,250,000
  - 渡劫飞升：2,500,000 → 6,250,000
  - 提升升级挑战性，使游戏节奏更加平衡

### 🎉 灵宠系统优化
- **提高灵宠获得概率**: 大幅提升灵宠获得几率
  - 抽奖系统中灵宠权重提升：
    - 灵狐（普通）：权重从 5 提升至 12（2.4倍）
    - 雷虎（稀有）：权重从 3 提升至 8（2.7倍）
    - 凤凰（仙品）：权重从 1 提升至 3（3倍）
  - AI 历练事件中灵宠概率提升：
    - 灵宠事件概率约 15-20%（在提示词中明确标注）
    - 灵宠机缘事件概率约 10-15%
    - 优化 AI 生成逻辑，建议在灵宠事件中较高概率返回 `petObtained` 字段
  - 玩家现在更容易通过抽奖和历练获得灵宠，提升收集体验

### 🐛 Bug修复
- **存档清除功能**: 修复重新开始游戏无法清除存档的问题
  - 在 `handleRebirth` 函数中添加 `clearAllSlots()` 调用
  - 清除所有存档槽位（1-10）及其备份
  - 同时清除旧存档系统的数据（兼容性处理）
  - 修复刷新页面后仍可继续之前游戏的问题
  - 确保重新开始游戏后完全重置，返回游戏开始界面

### 📚 代码优化
- 优化游戏平衡配置，统一修为需求计算
- 改进抽奖系统权重配置，提升代码可读性
- 优化 AI 服务提示词，明确灵宠事件概率要求
- 统一存档清除逻辑，确保数据完全重置

### 🎯 稳定性提升
- 修复存档清除不彻底导致的潜在问题
- 改进游戏节奏平衡，提升长期游戏体验
- 优化灵宠系统，提升玩家收集乐趣

---

## [0.2.6] - 2025-12-20

### 🐛 Bug修复
- **任务系统**: 修复任务执行中奇遇继续功能缺失的问题
  - 添加 `handleEncounterContinue` 函数，支持任务执行过程中遇到奇遇后继续完成任务
  - 修复"无法找到 handleEncounterContinue"的错误
  - 优化任务执行流程，确保奇遇事件后可以正常继续任务进度
- **宗门系统**: 修复挑战宗主功能未定义的问题
  - 在 `useSectHandlers` 中添加 `onChallengeLeader` 和 `player` 参数
  - 修复"无法找到 onChallengeLeader"的错误
  - 确保挑战宗主功能正常工作
- **战斗系统**: 修复战斗结果处理中的常量赋值错误
  - 将 `newHp` 从 `const` 改为 `let`，允许在挑战失败时重新赋值
  - 修复"无法赋值给常量"的错误
  - 确保挑战宗主失败时能正确扣除额外气血

### 🎉 新增功能
- **调试模式**: 添加修改宗门贡献功能
  - 在调试模式的宗门标签页中添加宗门贡献修改控件
  - 支持直接输入数值修改贡献
  - 提供 +1K 和 -1K 快捷按钮
  - 仅在已加入宗门时显示，方便调试测试
- **死亡系统**: 改进死亡原因描述
  - 新增 `generateDetailedDeathReason` 函数，生成更具体的死亡原因
  - 根据战斗记录的最后一击（是否暴击、伤害大小）生成不同描述
  - 区分战斗失败和胜利但死亡的情况，提供更详细的描述
  - 为无战斗记录的死亡情况添加多种随机描述
  - 改进寿命归零时的死亡描述，更加具体和生动

### 🔧 优化改进
- **任务限制系统**: 重构任务限制机制
  - 从按耗时类型（瞬时、短暂、中等、较长）限制改为按单个任务限制
  - 每个任务独立计算每日完成次数，每天最多3次
  - 移除同类型任务限制，不同任务之间互不影响
  - 更新 `dailyTaskCount` 数据结构为 `Record<string, number>`，按任务ID记录
  - 优化任务状态检查逻辑，提升用户体验
- **宗门系统**: 改进晋升宗主流程
  - 点击"申请晋升"时，如果目标是宗主，弹出确认对话框
  - 确认对话框提示挑战风险和失败惩罚
  - 确认后直接开始挑战战斗，流程更加顺畅
  - 优化用户交互体验，避免误操作
- **类型系统**: 完善类型定义
  - 添加 `sectMasterId` 字段到 `PlayerStats` 接口
  - 用于记录当前宗门的宗主ID（如果玩家是宗主，则为玩家自己的ID）
  - 更新相关初始化代码和兼容性处理
- **属性计算系统**: 重构玩家属性计算逻辑
  - 新增 `statUtils.ts` 工具文件，统一管理属性计算相关函数
  - 新增 `getActiveMentalArt` 函数，支持获取激活的心法（包括普通功法和传承功法）
  - 新增 `getPlayerTotalStats` 函数，统一计算玩家总属性（基础属性 + 装备 + 功法 + 称号 + 天赋）
  - 支持传承功法转换为心法格式，确保属性计算正确
  - 在 `StatsPanel`、`CharacterModal`、`battleService` 等模块中应用新的工具函数
  - 优化属性计算逻辑，确保心法加成正确应用到战斗和显示中

### 📚 代码优化
- 重构任务限制相关代码，提升可维护性
- 优化死亡原因生成逻辑，代码结构更清晰
- 改进类型定义，增强类型安全性
- 统一代码风格，提升代码可读性

### 🎯 稳定性提升
- 修复潜在的运行时错误
- 改进状态管理逻辑，确保数据一致性
- 优化任务系统，避免限制逻辑冲突
- 增强错误处理机制，提升系统稳定性

---

## [0.2.5] - 2025-12-19

### 🎉 新增功能
- **日常任务系统**: 完整的日常任务系统
  - 每日自动生成10-20个随机任务，从30个预定义任务模板中选择
  - 支持多种任务类型：打坐、历练、突破、炼丹、装备、灵宠、宗门、秘境、击杀、收集、学习等
  - 任务自动跟踪进度，完成时自动标记
  - 完成任务后可手动领取奖励（修为、灵石、抽奖券）
  - 任务按稀有度分类（普通、稀有、传说、仙品），不同稀有度奖励不同
  - 每日自动重置任务，支持游戏天数统计
  - 提供任务筛选和排序功能（按稀有度、进度、奖励等）
  - 显示任务完成率和统计信息
- **键盘快捷键系统**: 完整的键盘快捷键支持
  - 支持自定义快捷键配置，可在设置中修改
  - 提供丰富的默认快捷键：打坐、历练、打开各种面板等
  - 支持组合键（Ctrl、Shift、Alt、Meta）
  - 智能检测输入状态，避免在输入框中误触发
  - 支持快捷键分类和描述，便于用户理解
  - 快捷键可在设置中保存和恢复
- **战斗结果处理优化**: 独立的战斗结果处理Hook
  - 将战斗结果处理逻辑抽离为独立的 `useBattleResultHandler` Hook
  - 统一处理战斗后的状态更新、物品奖励、任务进度等
  - 支持战斗结果与日常任务系统联动，自动更新任务进度
  - 改进物品奖励处理逻辑，支持装备类物品单独管理
  - 优化灵宠技能冷却时间管理
- **延迟状态管理**: 新增 `useDelayedState` Hook
  - 自动管理延迟状态，支持自动清理定时器
  - 用于物品操作日志的延迟显示和自动清除
  - 避免内存泄漏，提升性能

### 🔧 优化改进
- **代码审查与优化**: 全面审查和优化核心代码
  - 对 `App.tsx` 进行全面的代码审查，提升代码质量和可维护性
  - 优化状态更新逻辑，确保数据一致性
  - 改进错误处理机制，提升系统稳定性
  - 统一代码风格，提升可读性
  - 模块化重构，将业务逻辑抽离到独立的 handlers

### 🐛 Bug修复
- **类型安全改进**: 修复类型安全问题
  - 改进 `updateQuestProgress` 函数的类型验证，添加运行时类型检查
  - 确保传入的任务类型是有效的 `DailyQuestType`，避免类型错误
  - 移除不必要的类型断言，提升类型安全性
- **逻辑优化**: 修复潜在的逻辑问题
  - 移除多余的 `dailyQuestHandlers` 存在性检查（该对象总是存在）
  - 简化战斗结果处理逻辑，改进条件判断
  - 优化自动历练暂停状态管理，确保状态正确清除
  - 修复日常任务初始化时机问题，确保任务正确生成

### 📚 代码优化
- **类型系统**: 增强类型安全性
  - 添加运行时类型验证，确保类型安全
  - 改进类型定义，减少类型错误风险
  - 通过 TypeScript 严格类型检查
  - 完善 `DailyQuestType` 类型定义，支持所有任务类型
- **代码质量**: 提升代码质量
  - 通过所有 Linter 检查，无错误和警告
  - 优化代码结构，提升可维护性
  - 改进代码注释，提升可读性
  - 模块化重构，将功能拆分为独立的 handlers
  - 统一业务逻辑处理模式，提升代码一致性

### 🎯 稳定性提升
- 修复潜在的运行时错误
- 改进状态管理逻辑，减少状态不一致的情况
- 优化自动功能的状态切换，提升用户体验
- 确保所有类型检查通过，提升代码健壮性
- 改进日常任务系统的初始化逻辑，避免重复生成
- 优化战斗结果处理，确保状态更新正确
- 改进内存管理，避免定时器泄漏

---

## [0.2.4] - 2025-12-17

### 🎉 新增功能
- **战斗系统**: 添加神识属性到敌人和玩家战斗计算
  - 在战斗组件中引入神识属性，提升战斗系统的策略性
  - 优化角色面板，显示神识属性相关信息
  - 更新战斗服务，将神识纳入战斗计算逻辑

### 🐛 Bug修复
- **丹药和草药系统**: 优化效果规范，调整历练流失寿命逻辑
  - 优化AI服务中的丹药和草药效果生成逻辑，确保效果描述更准确
  - 调整历练过程中的寿命流失机制，使游戏平衡性更合理
  - 修复历练事件中寿命计算可能出现的问题

### 🔧 优化改进
- **数值系统**: 全面优化游戏数值平衡
  - 调整战斗服务中的数值计算逻辑，优化战斗体验
  - 优化随机服务，改进掉落概率和随机事件分布
  - 优化商店服务，调整商品价格和稀有度分布
  - 优化历练系统，改进事件触发和奖励机制
  - 更新游戏常量配置，平衡各项数值参数
- **丹药效果系统**: 优化丹药效果处理
  - 完善丹药效果类型定义，提升类型安全性
  - 优化丹药效果应用逻辑，确保效果正确生效
  - 改进丹药效果显示和描述
- **调试模式**: 优化调试功能处理
  - 简化调试模式相关代码，提升可维护性
  - 优化调试面板的显示逻辑
  - 改进调试功能的稳定性
- **功法系统**: 完善功法相关问题
  - 修复功法相关问题，提升功法系统的稳定性
  - 优化功法相关的历练事件处理逻辑

### 📚 代码优化
- 重构战斗服务，优化代码结构
- 优化历练核心处理逻辑，提升代码可维护性
- 改进类型定义，增强类型安全性
- 优化常量配置，统一数值管理
- 改进代码注释，提升代码可读性

### 🎯 稳定性提升
- 修复潜在的数值计算错误
- 改进错误处理机制，提升系统稳定性
- 优化性能，减少不必要的计算

---

## [0.2.3] - 2025-12-18

### 🎉 版本更新
- 版本号更新至 0.2.3

---

## [0.2.2] - 2025-12-17

### 🐛 Bug修复
- **功法阁系统**: 修复领悟功法后不显示的问题
  - 重构功法列表显示逻辑，改用 `useMemo` 直接计算，确保依赖项正确更新
  - 修复 `useEffect` 依赖项比较问题，确保 `unlockedArts` 更新时列表自动刷新
  - 修复功法列表状态同步问题，新解锁的功法能够立即显示
  - 优化功法筛选逻辑，修复"未获得"筛选不正确排除已学习/已解锁功法的问题
- **物品系统**: 修复丹方类型判断和使用问题
  - 添加丹方类型的特殊判断逻辑，确保名称包含"丹方"的物品被正确识别为 `Recipe` 类型
  - 丹方判断优先级高于丹药判断，避免将"仙灵丹丹方"误判为丹药类型
  - 修复丹方在物品界面无法使用的问题，现在可以正常"研读"丹方
  - 在物品类型检查中添加丹方关键词检测，确保类型判断准确
- **装备系统**: 修复装备稀有度显示问题
  - 统一稀有度显示为中文（普通、稀有、传说、仙品），不再显示英文
  - 在装备栏位和日志输出中使用统一的 `normalizeRarityValue` 函数
  - 修复装备面板中稀有度显示为英文的问题（如 "common" 显示为 "普通"）
- **日常任务系统**: 完善任务完成判定逻辑
  - 优化 `updateQuestProgress` 函数，确保完成判定正确
  - 添加注释说明完成判定逻辑，提升代码可维护性
  - 修复边界情况处理，确保进度不会超过目标值

### 🔧 优化改进
- **功法阁界面**: 重构功法列表管理逻辑
  - 移除复杂的 `useEffect` + `useState` 组合，改用 `useMemo` 直接计算
  - 优化功法排序逻辑，已激活 > 已学习 > 已解锁 > 未解锁
  - 修复状态筛选功能，现在可以正确筛选"已学习"、"已获得"、"未获得"三种状态
  - 改进功法列表更新机制，确保数据变化时列表及时刷新
- **物品工具函数**: 优化类型推断逻辑
  - 在 `inferItemTypeAndSlot` 中添加丹方关键词检测
  - 提升物品类型判断的准确性和优先级处理
  - 优化代码结构，提升可维护性
- **稀有度工具函数**: 统一稀有度规范化逻辑
  - 在 `rarityUtils.ts` 中添加 `normalizeRarityValue` 函数
  - 统一处理英文别名到中文的转换（如 "common" → "普通"）
  - 在装备面板和日志输出中使用统一的规范化函数

### 📚 代码优化
- 重构 `CultivationModal` 组件，简化状态管理逻辑
- 优化 `itemUtils.ts` 中的物品类型推断逻辑
- 统一稀有度处理逻辑，避免代码重复
- 改进代码注释和文档，提升代码可读性

### 🎯 稳定性提升
- 修复功法列表状态不同步导致的显示问题
- 改进物品类型判断的准确性，减少类型错误
- 优化日常任务完成判定，确保逻辑正确

---

## [0.2.0] - 2025-12-16

### 功能新增
 - **存档管理器** 支持多份存档本地管理
 - **声望系统以及事件触发** 历练可以触发声望事件，可以进入对应的声望商店

### 🐛 Bug修复
- **战斗系统**: 修复回合制战斗结果处理中的类型错误
  - 修复 `handleTurnBasedBattleClose` 中访问不存在的 `playerHpAfter` 属性导致的类型错误
  - 改进战斗后血量计算逻辑，使用当前玩家状态正确计算战斗后的血量
  - 优化自动历练暂停状态管理，确保玩家死亡时正确清除暂停状态

### 🔧 优化改进
- **自动历练系统**: 改进自动历练暂停和恢复机制
  - 优化战斗结束后自动历练的恢复逻辑
  - 改进商店打开时自动历练的暂停处理
  - 确保玩家死亡时正确清除所有自动历练相关状态
  - 添加更清晰的状态管理注释，提升代码可维护性
  - 物品掉落概率平衡
  - 筛选功能完善
  - 商店完善

### 📚 代码优化
- **代码审查**: 全面审查和优化核心代码
  - 修复类型安全问题，移除不必要的类型断言
  - 优化状态更新时序，确保数据一致性
  - 改进错误处理逻辑，提升代码健壮性
  - 统一代码风格，提升可读性

### 🎯 稳定性提升
- 修复潜在的运行时错误
- 改进状态管理逻辑，减少状态不一致的情况
- 优化自动功能的状态切换，提升用户体验

---

## [0.1.7] - 2025-12-13

### 🐛 Bug修复
- **战斗系统**: 修复敌人速度比玩家快时战斗卡住的问题
  - 添加 `isProcessingEnemyTurnRef` 锁机制，防止敌人回合处理时重复触发
  - 优化 useEffect 依赖项，减少不必要的重新执行
  - 改进状态更新时序，使用 setTimeout 确保状态更新完成后再重置处理标志
  - 在组件关闭时正确清理所有 ref 和状态
- **战斗系统**: 修复秘境触发战斗初始化卡住的问题
  - 为 AI 生成敌人名称调用添加 3 秒超时保护
  - 为整个战斗初始化过程添加 10 秒超时保护
  - 使用 Promise.race 确保即使 AI API 超时也能快速回退到预设敌人名称
  - 添加超时错误提示，允许用户重试

### 🔧 优化改进
- **AI 系统**: 优化物品生成提示词，提升物品名称多样性
  - 在 systemMessage 中添加详细的物品命名规则
  - 为各类物品（草药、丹药、材料、武器、护甲、首饰、法宝）提供命名风格建议
  - 按稀有度提供命名区分指导（普通/稀有/传说/仙品）
  - 在各种事件类型中添加针对性的物品名称多样性要求
  - 强调每次生成物品时使用不同的名称组合，避免模板化重复
- **物品系统**: 规范化物品效果类型，确保描述与效果一致
  - 限制临时效果（effect）只能包含：hp、attack、defense、speed、exp
  - 其他属性（spirit、physique、maxHp、lifespan 等）自动归类为永久效果（permanentEffect）
  - 装备类物品不受此限制（因为装备效果是持续生效的）
  - 在物品生成和使用时自动应用规范化规则
  - 修复已知物品定义中的不一致问题（如凝神花）

### 📚 代码优化
- 优化战斗初始化逻辑，提升稳定性和用户体验
- 改进物品效果处理逻辑，确保数据一致性
- 增强错误处理和超时保护机制

---

## [0.1.4] - 2025-12-05

### 🐛 Bug修复
- **历练系统**: 修复AI返回JSON格式错误导致气血和修为显示NaN的问题
  - 在AI服务中添加数据验证，确保所有必需字段都有有效的数字值
  - 在历练处理逻辑中添加安全检查，防止NaN传播到玩家状态
  - 支持字符串数字的自动转换
  - 当AI返回不完整或格式错误的JSON时，使用安全的默认值（0）替代

### 🔧 优化改进
- **功法阁**: 为学习功法功能添加弹窗提醒
  - 当功法无法学习时，显示友好的弹窗提示而不是仅在日志中显示
  - 支持多种错误情况的弹窗提醒：
    - 已学习过的功法
    - 灵石不足（显示所需和当前数量）
    - 境界不足（显示所需境界和当前境界）
    - 宗门要求不满足
    - 属性要求不满足（显示所有不满足的属性详情）
  - 改进属性检查显示，将多个不满足的属性合并显示在一个弹窗中
  - 保留原有的日志记录，便于追踪

### 📚 代码优化
- 优化AI服务的数据验证逻辑，提升错误处理能力
- 改进历练核心处理逻辑，增强数据安全性

---

## [0.1.3] - 2025-12-05

### 🎉 新增功能
- **功法系统**: 添加功法品级分类系统
  - 新增天、地、玄、黄四个品级分类
  - 功法列表中显示品级标签，不同品级有不同颜色标识
  - 添加品级筛选功能，可按品级筛选功法
  - 新增20种新功法到功法池中
- **抽奖券系统**: 改为本地概率判定
  - 不再依赖AI返回抽奖券奖励
  - 每次历练有5%概率获得抽奖券（可在代码中调整1%-10%范围）
  - 获得数量在1-10张之间随机

### 🐛 Bug修复
- **功法界面**: 修复打开功法界面时React Hooks调用顺序错误
  - 将条件返回移到所有Hooks调用之后，符合React Hooks规则
  - 修复"Rendered more hooks than during the previous render"错误

### 🔧 优化改进
- **功法界面**: 优化功法列表显示
  - 添加空状态提示（无符合条件的功法时显示）
  - 改进品级标签的视觉效果
  - 添加类型筛选和品级筛选的UI优化

### 📚 代码优化
- 为所有现有功法添加了品级属性
- 更新了CultivationArt接口，添加grade字段
- 优化了抽奖券获取逻辑，提升游戏体验的稳定性

---

## [0.1.0] - 2025-12-05

### 🐛 Bug修复
- **战斗系统**: 修复回合制战斗界面技能列表无法滚动的问题
  - 技能列表添加滚动功能，现在可以查看所有可用/不可用技能
  - 丹药列表同样支持滚动显示

### 🔧 优化改进
- **Docker部署**: 完善Docker环境变量配置
  - 支持在构建时注入Vite环境变量（VITE_AI_KEY等）
  - 更新Dockerfile，添加构建参数（ARG）支持
  - 优化docker-compose.yml配置，自动读取.env文件
  - 新增镜像打包和迁移指南
  - 添加 npm 脚本实现一键构建和打包（`docker:build-and-pack`）
  - 添加 npm 脚本实现一键构建和启动（`docker:build-and-up`）

### 📚 文档更新
- 完善Docker部署文档（DOCKER.md）
  - 添加环境变量详细配置说明
  - 新增镜像打包成tar文件的完整流程
  - 补充导入/导出镜像的操作指南
  - 添加快速命令参考表（npm 脚本和 Makefile）
- 新增版本更新日志（CHANGELOG.md）
  - 记录版本更新历史
  - 提供功能计划路线图
- 新增 Makefile
  - 为习惯使用 make 命令的用户提供便利
  - 包含所有常用 Docker 操作命令
- 新增 Docker 使用示例文档（DOCKER_EXAMPLES.md）
  - 提供 7 个常见场景的完整示例
  - 包含故障排查和最佳实践
  - 详细的问答和快速参考表

### 🎨 界面优化
- **设置界面**: 添加版本号显示
  - 显示当前游戏版本（v0.1.0）
  - 添加"查看更新日志"快捷链接

---

## 版本说明

### 版本号规则
本项目遵循 [语义化版本](https://semver.org/lang/zh-CN/) 规范：
- **主版本号（MAJOR）**: 不兼容的API修改
- **次版本号（MINOR）**: 向下兼容的功能性新增
- **修订号（PATCH）**: 向下兼容的问题修正

### 更新类型标识
- 🎉 **新增功能**: 新增的游戏功能或特性
- 🐛 **Bug修复**: 修复的问题和bug
- 🔧 **优化改进**: 性能优化、用户体验改进
- 💥 **破坏性变更**: 不向下兼容的更改
- 🎨 **界面优化**: UI/UX相关改进
- 📚 **文档更新**: 文档和说明的更新
- 🔒 **安全更新**: 安全相关的修复和更新

---

## [计划中的功能]

### 游戏系统
- [ ] 更多秘境探索内容
- [ ] 灵宠进阶系统
- [ ] 宗门任务系统
- [ ] 社交功能（好友、聊天）

### 技术优化
- [ ] 游戏存档云同步
- [ ] 移动端适配优化
- [ ] 性能优化（大数据量处理）

### 界面改进
- [ ] 更多动画效果
- [ ] 可自定义主题
- [ ] 快捷键支持

---

## 历史版本

*历史版本信息将在正式发版时补充*

---

## 反馈与建议

如果您在使用过程中遇到问题或有改进建议，欢迎：
- 提交 [GitHub Issue](https://github.com/your-repo/react-xiuxian-game/issues)
- 联系开发团队

感谢您的支持！

